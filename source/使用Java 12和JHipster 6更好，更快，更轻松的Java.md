2019å¹´4æœˆ4æ—¥  é©¬ç‰¹é›·å¸ƒå°”

# ä½¿ç”¨Java 12å’ŒJHipster 6æ›´å¥½ï¼Œæ›´å¿«ï¼Œæ›´è½»æ¾çš„Java

æœ€è¿‘åœ¨Javaç”Ÿæ€ç³»ç»Ÿä¸­å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚ç°åœ¨ä¸»è¦çš„Javaç‰ˆæœ¬æ¯å…­ä¸ªæœˆå‘å¸ƒä¸€æ¬¡ï¼Œå¯èƒ½å¾ˆéš¾è·Ÿä¸Šã€‚å°±ä¸ªäººè€Œè¨€ï¼Œæˆ‘ä½¿ç”¨Spring Bootå¼€å‘äº†å¤§å¤šæ•°Javaåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œåœ¨å»å¹´10æœˆSpring Boot 2.1å‘å¸ƒä¹‹å‰ï¼Œæˆ‘è¢«å›°åœ¨Java 8ä¸Šã€‚

Spring Boot 2.1å¢åŠ äº†Java 11æ”¯æŒï¼Œæ€§èƒ½æ”¹è¿›ï¼Œæ–°çš„åº¦é‡å®ç°ï¼Œæ–°çš„æ‰§è¡Œå™¨ç«¯ç‚¹ä»¥åŠSpring Securityçš„ä¸€æµOIDCæ”¯æŒã€‚

åœ¨æˆä¸ºJavaå¼€å‘äººå‘˜ä¹‹å‰ï¼Œæˆ‘æ˜¯ä¸€åWebå¼€å‘äººå‘˜ã€‚æˆ‘å·²ç»å¼€å‘äº†20å¹´çš„Javaï¼Œæ‰€ä»¥è¿™è¯´äº†å¾ˆå¤šï¼å¦‚æœæ‚¨æ˜¯Javaå¼€å‘äººå‘˜ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šå¯¹JavaScriptä¸–ç•Œçš„å˜åŒ–é€Ÿåº¦æ„Ÿåˆ°å›°æƒ‘ã€‚å¦‚æœæ‚¨è®¤ä¸ºJavaå¾ˆéš¾è·Ÿä¸Šï¼Œè¯·å°è¯•è·Ÿä¸ŠJavaScriptåŠå…¶ç”Ÿæ€ç³»ç»Ÿï¼å¥½æ¶ˆæ¯æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•æ¥è·Ÿä¸Šä¸¤è€…ï¼šåªä½¿ç”¨[JHipster](https://www.jhipster.tech/)ã€‚

JHipster 6ä½¿ç”¨Spring Boot 2.1ä½œä¸ºå…¶åç«¯APIï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨Java 11+å¼€å‘JHipsteråº”ç”¨ç¨‹åºï¼

å¦‚æœæ‚¨æ›´æ„¿æ„è§‚çœ‹è§†é¢‘ï¼Œ[æˆ‘ä¼šåˆ›å»ºæ­¤åšå®¢æ–‡ç« çš„æˆªå±è§†é¢‘](https://youtu.be/Ktnvqoouulg)ã€‚



## [JHipsterå¦‚ä½•ä½¿Javaå’ŒJavaScriptå¼€å‘æ›´å®¹æ˜“ï¼Ÿ](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#how-does-jhipster-make-java-and-javascript-development-easier)

JHipsteræ˜¯æˆ‘åœ¨è¿™ä¸ªæ˜Ÿçƒä¸Šæœ€å–œæ¬¢çš„å¼€æºé¡¹ç›®ä¹‹ä¸€ã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆï¼Œå¼€å‘å’Œéƒ¨ç½²Spring Boot + Angularåº”ç”¨ç¨‹åºçš„å¼€å‘å¹³å°ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æ”¯æŒReactï¼ŒVueä»¥åŠä½¿ç”¨Netflix OSSï¼ŒElastic Stackå’ŒDockeråˆ›å»ºå¾®æœåŠ¡æ¶æ„ã€‚

Javaå¼€å‘äººå‘˜å€¾å‘äºä¸å–œæ¬¢JavaScriptï¼Œä½†å¾ˆå¤šäººéƒ½å–œæ¬¢ä½¿ç”¨TypeScriptã€‚ä½ çŒœæ€ä¹ˆç€ï¼ŸJHipsteråœ¨å…¶æ‰€æœ‰UIæ¡†æ¶å®ç°ä¸­ä½¿ç”¨TypeScriptï¼

JHipsteré€šè¿‡ä¸ºæ‚¨é…ç½®æ‰€æœ‰å†…å®¹å¹¶ä½¿ç”¨å…¶åº•å±‚æ¡†æ¶çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä½¿Javaå’ŒJavaScriptå¼€å‘æ›´å®¹æ˜“ã€‚æƒ³è¦å‡çº§æ‚¨çš„åº”ç”¨ä»¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Ÿç®€å•åœ°è·‘`jhipster upgrade`ã€‚

## [å®‰è£…Java 11æˆ–Java 12](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#install-java-11-or-java-12)

åœ¨æ‚¨æ‹…å¿ƒå®‰è£…JHipsterä¹‹å‰ï¼Œè¯·å®‰è£…Java 11.æˆ‘å»ºè®®ä½¿ç”¨[SDKMANï¼](https://sdkman.io/)ä¸ºäº†è¿™ä¸ªä»»åŠ¡ã€‚å¦‚æœæ‚¨æ²¡æœ‰å®‰è£…å®ƒï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå‘½ä»¤ï¼š

```shell
curl -s "https://get.sdkman.io" | bash
```

å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ‰€æœ‰å¯ç”¨çš„Java 11ç‰ˆæœ¬`sdk list java`ã€‚

å®‰è£…OpenJDKç‰ˆæœ¬ï¼š

```shell
sdk install java 11.0.2-open
```

å¦‚æœæ‚¨æ›´æ„¿æ„ä½¿ç”¨äºšé©¬é€Šçš„Correttoï¼Œåªéœ€ä½¿ç”¨`11.0.2-amzn`è¯¥åç§°å³å¯ã€‚å¦‚æœä½ æƒ³å°½å¯èƒ½çš„æ—¶é«¦ï¼Œä½ ç”šè‡³å¯ä»¥ä½¿ç”¨Java 12ï¼

```shell
sdk install java 12.0.0-open
```

|      | å¦‚æœæ‚¨ä½¿ç”¨`12.0.0-zulu`åç§°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Azulçš„Zulu ã€‚ |
| ---- | ---------------------------------------------------- |
|      |                                                      |

## [å®‰è£…JHipster 6](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#install-jhipster-6)

JHipster 6äº[2019å¹´5æœˆ3æ—¥å‘å¸ƒ](https://www.jhipster.tech/2019/05/02/jhipster-release-6.0.0.html)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…å®ƒã€‚

```shell
npm install -g generator-jhipster@6.0.0
```

|      | è¯¥`npm`å‘½ä»¤æ˜¯[Node.jsçš„](https://nodejs.org/)ä¸€éƒ¨åˆ†ã€‚æ‚¨éœ€è¦è®©Node 10.xå®‰è£…JHipsterå¹¶è¿è¡Œæœ‰ç”¨çš„å‘½ä»¤ã€‚ |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

## [åˆ›å»ºä¸€ä¸ªåœ¨Java 11+ä¸Šè¿è¡Œçš„Spring Boot + Angular App](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#create-a-spring-boot-angular-app-that-runs-on-java-11)

å¼€å§‹ä½¿ç”¨JHipsterçš„æœ€åŸºæœ¬æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œcdè¿›å…¥å®ƒå¹¶è¿è¡Œ`jhipster`ã€‚ç³»ç»Ÿä¼šæç¤ºæ‚¨å›ç­”æœ‰å…³æ‚¨è¦åˆ›å»ºçš„åº”ç”¨çš„ä¸€äº›é—®é¢˜ã€‚é—®é¢˜èŒƒå›´ä»æ‚¨çš„åº”ç”¨ç¨‹åºåç§°åˆ°æ‚¨è¦ä½¿ç”¨çš„èº«ä»½éªŒè¯ç±»å‹ï¼Œå†åˆ°SQLä¸NoSQLã€‚

JHipsterè¿˜æœ‰ä¸€ç§åŸŸè¯­è¨€ï¼ˆç§°ä¸ºJLipsteråŸŸè¯­è¨€çš„JDLï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å®šä¹‰æ‚¨çš„åº”ç”¨ç¨‹åºã€‚

```plaintext
application {
  config {}
}
```

å¦‚æœæ‚¨ä½¿ç”¨ä¸Šè¿°ä»£ç åˆ›å»ºåº”ç”¨ç¨‹åºï¼Œå®ƒå°†ä½¿ç”¨é»˜è®¤å€¼ï¼š

- baseNameçš„ï¼š `jhipster`
- ç”³è¯·ç±»å‹ï¼š `monolith`
- æ•°æ®åº“ç±»å‹ï¼š `sql`
- ç­‰ç­‰

|      | æ‚¨å¯ä»¥åœ¨[JHipsterçš„JDLæ–‡æ¡£ä¸­](https://www.jhipster.tech/jdl/#available-application-options)çœ‹åˆ°æ‰€æœ‰é»˜è®¤å€¼ã€‚ |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

è¦ä½¿ç”¨JHipsterç”Ÿæˆå¯ç”¨OAuth 2.0çš„åº”ç”¨ç¨‹åºï¼Œè¯·`app.jh`åœ¨æ–°é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼ˆä¾‹å¦‚`~/hipapp`ï¼‰ï¼š

```plaintext
application {
  config {
    baseName hipapp
    authenticationType oauth2
  }
}
```

æ‰“å¼€ç»ˆç«¯çª—å£å¹¶å¯¼èˆªåˆ°ä¸æ­¤æ–‡ä»¶ç›¸åŒçš„ç›®å½•ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç”Ÿæˆå¸¦æœ‰Angular UIçš„Spring Boot APIã€‚

|      | ç¡®ä¿ä½ ä¸åœ¨ä½ çš„ä¸»ç›®å½•ä¸­ï¼æ‚¨çš„é¡¹ç›®å°†åœ¨ä¸...ç›¸åŒçš„ç›®å½•ä¸­ç”Ÿæˆ`app.jh`ã€‚ |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

```shell
jhipster import-jdl app.jh
```

è¿™å°†åˆ›å»ºå¤§é‡æ–‡ä»¶å¹¶ä½¿ç”¨å®‰è£…ä¾èµ–é¡¹`npm install`ã€‚è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œç»ˆç«¯åº”ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š

![Results of import-jdl](https://developer.okta.com/assets-jekyll/blog/java-12-jhipster-6/import-jdl-7db81bd6575856b5ad3769531b8d5f358d67dae3a1c975aefd2fea6aeb8c99bc.png)

å¦‚æœä½ æƒ³çœ‹çœ‹è¿™ä¸ªå‘½ä»¤åœ¨è¡ŒåŠ¨ä¸­çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆï¼Œä½ å¯ä»¥è§‚çœ‹ä¸‹é¢çš„å½•éŸ³ã€‚

<iframe src="https://asciinema.org/a/244194/embed?" id="asciicast-iframe-244194" name="asciicast-iframe-244194" scrolling="no" allowfullscreen="true" style="box-sizing: border-box; max-width: 100%; overflow: hidden; margin: 0px; border: 0px; display: inline-block; width: 804px; float: none; visibility: visible; height: 434px;"></iframe>

ç”±äºæ‚¨æŒ‡å®š`oauth2`äº†èº«ä»½éªŒè¯ç±»å‹ï¼Œå› æ­¤å°†ä¸ºKeycloakå®‰è£…Docker Composeé…ç½®ã€‚

[Keycloak](https://www.keycloak.org/)æ˜¯Apacheè®¸å¯çš„å¼€æºèº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚é™¤äº†[`src/main/docker/keycloak.yml`](https://github.com/jhipster/generator-jhipster/blob/master/generators/server/templates/src/main/docker/keycloak.yml.ejs)ä¸ºDocker Compose åˆ›å»ºæ–‡ä»¶å¤–ï¼ŒJHipsterè¿˜ä¼šç”Ÿæˆä¸€ä¸ª[`src/main/docker/config/realm-config`](https://github.com/jhipster/generator-jhipster/tree/master/generators/server/templates/src/main/docker/config/realm-config)åŒ…å«æ–‡ä»¶çš„ç›®å½•ï¼Œè¯¥ç›®å½•å°†Keycloaké…ç½®ä¸ºä¸JHipsterå¼€ç®±å³ç”¨ã€‚

## [è¿è¡Œæ‚¨çš„JHipsteråº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨Keycloakç™»å½•](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#run-your-jhipster-app-and-log-in-with-keycloak)

å¿…é¡»è¿è¡ŒKeycloakæ‰èƒ½ä½¿æ‚¨çš„JHipsteråº”ç”¨ç¨‹åºæˆåŠŸå¯åŠ¨ã€‚è¿™æ˜¯å› ä¸ºSpring Security 5.1çš„[ä¸€æµOIDCæ”¯æŒ](https://developer.okta.com/blog/2019/03/05/spring-boot-migration)åœ¨JHipster 6ä¸­å¾—åˆ°äº†å……åˆ†åˆ©ç”¨ã€‚

æ­¤OIDCæ”¯æŒåŒ…æ‹¬å‘ç°ï¼Œè¿™æ„å‘³ç€Spring Securityä¼šä¸`/.well-known/openid-configuration`ç«¯ç‚¹è¿›è¡Œé€šä¿¡ä»¥è¿›è¡Œè‡ªæˆ‘é…ç½®ã€‚æˆ‘è‡ªå·±å®Œæˆ[äº†è¿ç§»](https://github.com/jhipster/generator-jhipster/pull/9416)å¹¶åˆ é™¤äº†æ¯”æˆ‘æ·»åŠ çš„ä»£ç æ›´å¤šçš„ä»£ç ï¼

ä½¿ç”¨Docker Composeå¯åŠ¨Keycloakï¼š

```shell
docker-compose -f src/main/docker/keycloak.yml up -d
```

|      | å¦‚æœæ‚¨æ²¡æœ‰å®‰è£…Docker Composeï¼Œè¯·å‚é˜…[è¿™äº›è¯´æ˜](https://docs.docker.com/compose/install/)ä»¥äº†è§£å¦‚ä½•å®‰è£…å®ƒã€‚ |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

ç„¶åä½¿ç”¨Mavenå¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºï¼š

```shell
./mvnw
```

å½“æ‚¨çš„åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶è¿è¡Œæ—¶ï¼Œè¯·`http://localhost:8080`åœ¨æ‚¨å–œæ¬¢çš„æµè§ˆå™¨ä¸­æ‰“å¼€å¹¶å•å‡»**ç™»å½•**ã€‚æ‚¨å°†è¢«é‡å®šå‘åˆ°Keycloakï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥`admin/admin`ç™»å½•ã€‚

![æ¬¢è¿ï¼ŒJavaæ—¶é«¦](https://developer.okta.com/assets-jekyll/blog/java-12-jhipster-6/welcome-java-hipster-f98915cd9e41341e9bea62953d579dd0cdbe25dbdba7a5d1a55037f2ec310427.png)

æ¼‚äº®ï¼Œå—¯ï¼Ÿæ‚¨åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨æœ€æ–°å‘å¸ƒçš„Angularç‰ˆæœ¬çš„ç°ä»£å•é¡µé¢åº”ç”¨ç¨‹åºï¼ˆSPAï¼‰ï¼ä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜ä½¿ç”¨æœ€å®‰å…¨çš„OAuth 2.0å½¢å¼ - [æˆæƒä»£ç æµ](https://developer.okta.com/blog/2018/04/10/oauth-authorization-code-grant-type)ã€‚

|      | å¦‚æœæ‚¨å¯¹OAuth 2.0å’ŒOpenID Connectï¼ˆOIDCï¼‰å¦‚ä½•ååŒå·¥ä½œæ„Ÿåˆ°å›°æƒ‘ï¼Œè¯·å‚é˜…[ä»€ä¹ˆæ˜¯OAuthï¼Ÿ](https://developer.okta.com/blog/2017/06/21/what-the-heck-is-oauth)ç®€è€Œè¨€ä¹‹ï¼ŒOIDCæ˜¯OAuth 2.0ä¹‹ä¸Šçš„ä¸€ä¸ªè–„å±‚ï¼Œå¯ä»¥æ·»åŠ èº«ä»½ã€‚ |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

## [ä½¿ç”¨Oktaï¼šæˆ‘ä»¬æ°¸è¿œåœ¨çº¿ï¼](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#use-okta-were-always-on)

Keycloakæ˜¯ä¸€ä¸ªéå¸¸å‡ºè‰²çš„é¡¹ç›®ï¼Œéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒï¼Œæ‚¨å°†è´Ÿè´£ç»´æŠ¤å®ƒï¼Œå°†å…¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ç¡®ä¿å®ƒå…¨å¤©å€™è¿è¡Œã€‚å‡ºäºè¿™äº›åŸå› ï¼Œæˆ‘å»ºè®®åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨Oktaã€‚æ¯•ç«Ÿï¼Œæˆ‘ä»¬ä¸€ç›´*éƒ½åœ¨ï¼*ğŸ˜ƒ

### [åˆ›å»ºä¸€ä¸ªOpenID Connect Webåº”ç”¨ç¨‹åº](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#create-an-openid-connect-web-application)

é¦–å…ˆï¼Œæ³¨å†Œä¸€ä¸ª[æ°¸ä¹…å…è´¹çš„Oktaå¼€å‘è€…å¸æˆ·](https://developer.okta.com/signup/)ã€‚

ç™»å½•Oktaåï¼Œæ³¨å†Œæ‚¨çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚

- åœ¨é¡¶éƒ¨èœå•ä¸­ï¼Œå•å‡»â€œ **åº”ç”¨ç¨‹åºâ€**
- å•å‡»**æ·»åŠ åº”ç”¨ç¨‹åº**
- é€‰æ‹©**Web**ï¼Œç„¶åå•å‡»**ä¸‹ä¸€æ­¥**
- è¾“å…¥`Awesome OIDC`çš„**åç§°**ï¼ˆè¿™ä¸ªæ•°å€¼å¹¶ä¸é‡è¦ï¼Œå¯ä»¥éšæ„å»æ”¹å˜å®ƒï¼‰
- å°†Loginé‡å®šå‘URIæ›´æ”¹ä¸º `http://localhost:8080/login/oauth2/code/oidc`
- å•å‡»**â€œå®Œæˆâ€**ï¼Œç„¶åå•å‡»**â€œ** **ç¼–è¾‘â€**å¹¶æ·»åŠ `http://localhost:8080`ä¸ºâ€œæ³¨é”€â€é‡å®šå‘URI
- å•å‡»**ä¿å­˜**

å®Œæˆåï¼Œæ‚¨çš„è®¾ç½®åº”ç±»ä¼¼äºä¸‹é¢çš„å±å¹•æˆªå›¾ã€‚

![OIDCåº”ç”¨ç¨‹åºè®¾ç½®](https://developer.okta.com/assets-jekyll/blog/java-12-jhipster-6/app-settings-36cee2d55fa2872188a92e5c2c3c8d9d20ad2082d86b8fe6c7433c89567c3145.png)

`okta.env`åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†`{..}`å€¼æ›¿æ¢ä¸ºOktaåº”ç”¨ç¨‹åºä¸­çš„å€¼ï¼š

```shell
export SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_OIDC_ISSUER_URI="https://{yourOktaDomain}/oauth2/default"
export SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_ID="{clientId}"
export SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_SECRET="{clientSecret}"
```

|      | æ·»åŠ `*.env`åˆ°æ‚¨çš„`.gitignore`æ–‡ä»¶ï¼Œä»¥ä¾¿æ­¤æ–‡ä»¶ä¸ä¼šåœ¨æ‚¨çš„æºä»£ç ç®¡ç†ç³»ç»Ÿä¸­ç»“æŸã€‚ |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

### [åˆ›å»ºç»„å¹¶å°†å…¶æ·»åŠ ä¸ºIDä»¤ç‰Œçš„å£°æ˜](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#create-groups-and-add-them-as-claims-to-the-id-token)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒJHipsteré…ç½®ä¸ºä½¿ç”¨ä¸¤ç§ç±»å‹çš„ç”¨æˆ·ï¼šç®¡ç†å‘˜å’Œç”¨æˆ·ã€‚Keycloakè‡ªåŠ¨é…ç½®äº†ç”¨æˆ·å’Œç»„ï¼Œä½†æ‚¨éœ€è¦ä¸ºOktaç»„ç»‡è¿›è¡Œä¸€æ¬¡æ€§é…ç½®ã€‚

åˆ›å»ºä¸€ä¸ª`ROLE_ADMIN`å’Œ`ROLE_USER`ç»„ï¼ˆ**ç”¨æˆ·** > **ç»„** > **æ·»åŠ ç»„**ï¼‰å¹¶å‘å…¶æ·»åŠ ç”¨æˆ·ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨æ³¨å†Œçš„å¸æˆ·ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆâ€œ **ç”¨æˆ·â€** >â€œ **æ·»åŠ äººå‘˜â€**ï¼‰ã€‚å¯¼èˆªåˆ°**API** > **æˆæƒæœåŠ¡å™¨**ï¼Œç„¶åå•å‡»`default`æœåŠ¡å™¨ã€‚å•å‡»**å£°æ˜**é€‰é¡¹å¡å’Œ**æ·»åŠ å£°æ˜**ã€‚å°†å…¶å‘½å`groups`ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨IDä»¤ç‰Œä¸­ã€‚å°†å€¼ç±»å‹`Groups`è®¾ç½®ä¸ºå¹¶å°†è¿‡æ»¤å™¨è®¾ç½®ä¸ºæ­£åˆ™è¡¨è¾¾å¼`.*`ã€‚ç‚¹å‡»**åˆ›å»º**ã€‚

![æ·»åŠ å£°æ˜](https://developer.okta.com/assets-jekyll/blog/java-12-jhipster-6/add-claim-915f54ead19da14f9117ac982daa317f6782c0f8d9fe9fcb5de68f7beb2d6f90.png)

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨åº”ç”¨ç¨‹åºï¼š

```shell
source okta.env
./mvnw
```

å¯¼èˆªåˆ°`http://localhost:8080`å¹¶ä½¿ç”¨æ‚¨çš„Oktaå‡­æ®ç™»å½•ã€‚

![ç”±Oktaè®¤è¯](https://developer.okta.com/assets-jekyll/blog/java-12-jhipster-6/authenticated-by-okta-c114234313c83a96ea1415c77dd665c626e49ac88487ab51513b9524176f6b9d.png)

Spring Bootå’ŒSpring Securityå¦‚ä½•è½»æ¾åˆ‡æ¢OIDCæä¾›å•†ï¼Œè¿™ä¸æ˜¯å¾ˆé…·å—ï¼Ÿï¼

## [ä¸JHipsterçš„CRUD](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#crud-with-jhipster)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å‡ ä¹æ²¡æœ‰æŠ“ä½JHipsteræ‰€èƒ½æä¾›çš„æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨JDLä¸ºå®ä½“ï¼ˆå¸¦æœ‰æµ‹è¯•ï¼ï¼‰åˆ›å»ºCRUDåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œ`blog.jh`ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚

```plaintext
entity Blog {
  name String required minlength(3),
  handle String required minlength(2)
}

entity BlogEntry {
  title String required,
  content TextBlob required,
  date Instant required
}

entity Tag {
  name String required minlength(2)
}

relationship ManyToOne {
  Blog{user(login)} to User,
  BlogEntry{blog(name)} to Blog
}

relationship ManyToMany {
  BlogEntry{tag(name)} to Tag{entry}
}

paginate BlogEntry, Tag with infinite-scroll
```

ç„¶å`jhipster import-jdl blog.jh`åœ¨ä½ çš„é¡¹ç›®ä¸­è¿è¡Œã€‚è¯¥[JDL-æ ·å“](https://github.com/jhipster/jdl-samples) GitHubçš„ä»“åº“æœ‰æ›´å¤šçš„ä¾‹å­ã€‚

## [ä½¿ç”¨JHipsteråšæ›´å¤šäº‹æƒ…](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc#do-more-with-jhipster)

æˆ‘è¦æ„Ÿè°¢Spring Securityå›¢é˜Ÿçš„[Joe Grandja](https://twitter.com/joe_grandja)å’Œ[Rob Winch](https://twitter.com/rob_winch)ã€‚æ²¡æœ‰ä»–ä»¬çš„å¸®åŠ©ï¼ŒJHipsterçš„è¿ç§»ä½¿ç”¨Spring Security 5.1æ˜¯ä¸å¯èƒ½çš„ã€‚ä½ ä»¬*æ‘‡æ»š!!*

æˆ‘æ²¡æœ‰ä¸ºè¿™ç¯‡æ–‡ç« åˆ›å»ºä¸€ä¸ªGitHubå­˜å‚¨åº“ï¼Œå› ä¸ºç”Ÿæˆäº†æ‰€æœ‰ä»£ç ã€‚ä½ å¯ä»¥[åœ¨GitHubä¸Š](https://github.com/jhipster/generator-jhipster)æ‰¾åˆ°[JHipster](https://github.com/jhipster/generator-jhipster)çš„æºä»£ç ã€‚

å¦‚æœæ‚¨å¯¹å¦‚ä½•å°†JHipsterçš„æµ‹è¯•å‡çº§åˆ°Spring Security 5.1æ„Ÿå…´è¶£ï¼Œè¯·å‚é˜…[é€šè¿‡Java Hipsterçš„Upå‡çº§Spring Security OAuthå’ŒJUnitæµ‹è¯•](https://developer.okta.com/blog/2019/04/15/testing-spring-security-oauth-with-junit)ã€‚å¦‚æœæ‚¨æƒ³äº†è§£å¦‚ä½•ä½¿ç”¨JHipsterå¼€å‘å¾®æœåŠ¡ï¼Œè¯·å‚é˜…[ä½¿ç”¨Spring Cloud Configå’ŒJHipsterçš„Java](https://developer.okta.com/blog/2019/05/23/java-microservices-spring-cloud-config)å¾®æœåŠ¡ã€‚

æ„Ÿè°¢JHipsteråŠå…¶æ‰€æœ‰å‡ºè‰²çš„[è´¡çŒ®è€…](https://github.com/jhipster/generator-jhipster/graphs/contributors)ã€‚ä½ ä»¬éƒ½åœ¨é—²æš‡æ—¶é—´åšäº†å¤§é‡çš„å·¥ä½œï¼Œéå¸¸æ„Ÿè°¢ã€‚

è¿˜æ²¡å‡†å¤‡å¥½å‘JHipster 6å’ŒJava 11+è¿ˆè¿›å—ï¼Ÿæˆ‘å†™äº†ä¸€äº›ä½¿ç”¨JHipster 5å’ŒJava 8çš„æ•™ç¨‹ã€‚

- [ä½¿ç”¨Reactï¼ŒSpring Bootå’ŒJHipsteræ„å»ºç…§ç‰‡åº“PWA](https://developer.okta.com/blog/2018/06/25/react-spring-boot-photo-gallery-pwa)
- [ä½¿ç”¨OAuth 2.0å’ŒJHipsterå¼€å‘å¾®æœåŠ¡æ¶æ„](https://developer.okta.com/blog/2018/03/01/develop-microservices-jhipster-oauth)
- [ä½¿ç”¨Ionicä¸ºJHipsteråˆ›å»ºå…·æœ‰OIDCèº«ä»½éªŒè¯çš„ç§»åŠ¨åº”ç”¨ç¨‹åº](https://developer.okta.com/blog/2018/01/30/jhipster-ionic-with-oidc-authentication)
- [ä½¿ç”¨React Nativeå’ŒSpring Bootæ„å»ºç§»åŠ¨åº”ç”¨ç¨‹åº](https://developer.okta.com/blog/2018/10/10/react-native-spring-boot-mobile-app)

æˆ‘è¿˜ä¸ºInfoQçš„[JHipster](https://www.infoq.com/minibooks/jhipster-mini-book-5)å†™äº†ä¸€æœ¬[å…è´¹çš„è¿·ä½ ä¹¦](https://www.infoq.com/minibooks/jhipster-mini-book-5)ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³Spring Security 5.1åŠå…¶OIDCæ”¯æŒçš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ä¸€äº›æ”¯æŒï¼š

- [ä½¿ç”¨Spring Securityçš„OAuth 2.0å¿«é€ŸæŒ‡å—](https://developer.okta.com/blog/2019/03/12/oauth2-spring-security-guide)
- [å°†æ‚¨çš„Spring Bootåº”ç”¨ç¨‹åºè¿ç§»åˆ°æœ€æ–°å’Œæœ€å¥½çš„Spring Securityå’ŒOAuth 2.0](https://developer.okta.com/blog/2019/03/05/spring-boot-migration)
- [Spring Boot 2.1ï¼šå‡ºè‰²çš„OIDCï¼ŒOAuth 2.0å’ŒReactive APIæ”¯æŒ](https://developer.okta.com/blog/2018/11/26/spring-boot-2-dot-1-oidc-oauth2-reactive-apis)

åœ¨[@oktadev](https://twitter.com/oktadev)ä¸Šå…³æ³¨æˆ‘ä»¬ï¼Œä»¥ä¾¿åŠæ—¶äº†è§£Javaå’Œé¢†å…ˆçš„JavaScriptæ¡†æ¶ã€‚

**æ›´æ–°æ—¥å¿—ï¼š**

- 2019å¹´5æœˆ10æ—¥ï¼šæ›´æ–°åä½¿ç”¨JHipster 6.0 GAç‰ˆæœ¬å¹¶åµŒå…¥æˆªå±è§†é¢‘ã€‚å¯ä»¥åœ¨[okta.github.ioï¼ƒ2869ä¸­](https://github.com/okta/okta.github.io/pull/2869)æŸ¥çœ‹å¯¹æ­¤å¸–å­çš„æ›´æ”¹ã€‚



# å®‰è£…ä¸é…ç½®

## å®‰è£…å’Œé…ç½®nodejs

### ä¸‹è½½nodejs

https://nodejs.org/en/download/

### å®‰è£…nodejsåˆ°D:\nodejs

```
cd d:\nodejs
mkdir  node_global
mkdir node_cache
```

### é…ç½®ç¯å¢ƒå˜é‡:

```
NODE_PATH=d:\nodejs\node_global
PATH=%NODE_PATH%; d:\nodejs;â€¦â€¦
```

### é…ç½®NPMç¯å¢ƒå˜é‡ï¼š

```has
npm config set prefix "D:\nodejs\node_global"
npm config set cache "D:\nodejs\node_cache"
npm config set registry https://registry.npm.taobao.org
```

æ³¨æ„ï¼šè¿™ä¸‰ä¸ªå‘½ä»¤è®¾ç½®çš„ä¿¡æ¯ä¼šä¿å­˜åœ¨åœ¨C:\Users\ç”¨æˆ·å\.npmrcæ–‡ä»¶ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶

### æ£€æŸ¥ç‰ˆæœ¬

```
npm -v
node -v
```

## å®‰è£…Jhipster

```
npm install -g generator-jhipster
```

ï¼ˆå¯é€‰ï¼‰

```
npm install -g rimraf     #æˆ‘çš„ç¯å¢ƒä¸­éœ€è¦å®‰è£…ï¼Œå¦åˆ™åœ¨æ‰§è¡Œjhipsterè¿‡ç¨‹ä¸­æŠ¥rimrafä¸æ˜¯æœ‰æ•ˆçš„å‘½ä»¤é”™è¯¯
```

# ä½¿ç”¨Jhipster

```shell
mkdir d:\work
cd work
jhipster
```

è¿è¡Œï¼š

```
#åˆ†åˆ«åœ¨ä¸¤ä¸ªç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
mvnw
npm start
```

401 not authorized

https://stackoverflow.com/questions/43453672/wso2-is-how-to-allow-anonymous-request-to-oidc-well-known-openid-configuration

http://dinukshaish.blogspot.com/2017/02/oauth-20-dynamic-client-registration.html



http://hasanthipurnima.blogspot.com/2017/03/oidc-discovery-endpoint.html

ç¡®ä¿è¿™ä¸ªåœ°å€å¯ä»¥åŒ¿åè®¿é—®ï¼š

https://is.cd.mtn:9443/oauth2/token/.well-known/openid-configuration



spçš„å›è°ƒURLï¼š

regexp=(http://192.168.200.24:8080/login/oauth2/code/oidc|http://192.168.200.24:8080)



Post logout URI does not match with registered callback URI



https://is.cd.mtn:9443/authenticationendpoint/oauth2_error.do?oauthErrorCode=access_denied&oauthErrorMsg=Post+logout+URI+does+not+match+with+registered+callback+URI.&sp=oidctest&tenantDomain=carbon.super&sp=oidctest&tenantDomain=carbon.super



# å‚è€ƒï¼š

[jhipster - æ ‡ç­¾ - ç¾½å®¢ - åšå®¢å›­](https://www.cnblogs.com/yorkwu/tag/jhipster/)

[JHipster ä¸­æ–‡ç½‘](https://www.jhipster-cn.tech/)

[ä½¿ç”¨Java 12å’ŒJHipster 6æ›´å¥½ï¼Œæ›´å¿«ï¼Œæ›´è½»æ¾çš„Java](https://developer.okta.com/blog/2019/04/04/java-11-java-12-jhipster-oidc)

[ä½¿ç”¨JHipsterå¼€å‘å¾®æœåŠ¡å’Œç§»åŠ¨åº”ç”¨ç¨‹åº](https://www.pluralsight.com/courses/play-by-play-developing-microservices-mobile-apps-jhipster)